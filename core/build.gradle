apply plugin: "java"

sourceCompatibility = 1.7
[compileJava, compileTestJava]*.options*.encoding = 'UTF-8'

sourceSets.main.java.srcDirs = [ "src/" ]

task convert << {

    // copy textures
    FileTree textures = fileTree(dir: '../android/assets/data/models/fbx/', exclude: '**/*.fbx')

    textures.each { File file ->
        File target = new File(file.getPath().replaceAll('fbx', 'g3db'))

        copy {
            from file
            into target.getParent()
        }
    }

    // export fbx to g3db
    FileTree tree = fileTree(dir: '../android/assets/data/models/fbx/', include: '**/*.fbx')

    tree.each {File file ->
        println 'compiling ' + file.getName() + '...'
        task "makeG3DB${file.getParentFile().getName()}"(type:Exec) {

            // .../fbx/.../.*.fbx -> .../g3db/.../.*.g3db
            File target = new File(file.getPath().replaceAll('fbx', 'g3db'))
            target.getParentFile().mkdirs()

            workingDir '../android/assets/data/models/fbx-conv/'
            environment('LD_LIBRARY_PATH', '.')

            //linux
            commandLine './fbx-conv-lin64', file, target

            standardOutput = new ByteArrayOutputStream()

            ext.output = {
                return standardOutput.toString()
            }

            execute()
        }
    }

}

eclipse.project {
    name = appName + "-core"
    convert.execute()
}
